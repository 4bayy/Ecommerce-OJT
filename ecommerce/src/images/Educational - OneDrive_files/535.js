(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[535],{2080:function(e,t,n){"use strict";n.r(t),n.d(t,"spItemUploadItemsOperationHandler",function(){return g});var a=n(0),i=n(40),r=n(164),o=n(3862),s=n(7),c=n(144),d=n(2857),l=n(2),u=n(48),f=n(6),p=n(286),m=n(1718),_=n(179),h=n(167),b=n(1),g=Object(s.i)({mergeForSameItemKey:!1,maxParallelOperationCount:3,timeout:864e5})(function(e){var t=this,n=e.itemKey,s=e.options.sourceEntries,g=i.e.deserialize(n),v=g.webAbsoluteUrl,y=g.listFullUrl,S=Object.keys(s)[0],D=s[S].progressItemKey;return function(i){return Object(a.__awaiter)(t,void 0,void 0,function(){var t,s,I,x,C,O,w,E,A,L;return Object(a.__generator)(this,function(k){switch(k.label){case 0:return t=i(Object(c.e)({sourceFile:d.t},S)).sourceFile,s=i(Object(h.e)({listItemUploader:b.Je})).listItemUploader,I=void 0===s?o.t:s,[4,i(I(e))];case 1:return x=k.sent().itemKey,C=new p.e,D&&t&&C.resolveItems({items:(E={},E[D]=Object(a.__assign)(Object(a.__assign)({},u.r.pack({itemKey:x})),Object(l.t)({progressSize:u.g},{progressSize:{current:t.size}})),E)}),C.invalidateItems({items:(A={},A[n]=[f.t],A)}),g.listFullUrl&&(O=new _.e("".concat(g.listFullUrl,"/Forms")).path,g.rootFolder&&"".concat(g.rootFolder,"/").slice(0,O.length+1)==="".concat(O,"/")&&(w=r.e.serialize({webAbsoluteUrl:v,listFullUrl:y}),i(Object(m.e)({items:(L={},L[w]={childItemKey:x},L)})))),i(C.execute()),[2]}})})}})},2322:function(e,t,n){"use strict";var a,i;n.d(t,"e",function(){return i}),function(e){e[e.queued=0]="queued",e[e.started=1]="started",e[e.completed=2]="completed",e[e.aborted=3]="aborted",e[e.failed=4]="failed",e[e.none=5]="none"}(a||(a={})),function(e){e[e.none=0]="none",e[e.other=1]="other",e[e.general=2]="general",e[e.conflict=3]="conflict",e[e.similarNameExists=4]="similarNameExists",e[e.invalidName=5]="invalidName",e[e.fileSize=6]="fileSize",e[e.emptyFileOrFolder=7]="emptyFileOrFolder",e[e.emptyFileOrFolderForDocLib=8]="emptyFileOrFolderForDocLib",e[e.overQuota=9]="overQuota",e[e.accessDenied=10]="accessDenied",e[e.lockMismatch=11]="lockMismatch",e[e.overQuotaSharedFolder=12]="overQuotaSharedFolder",e[e.folderUploadNotSupported=13]="folderUploadNotSupported",e[e.versionMismatch=14]="versionMismatch",e[e.authFailure=15]="authFailure",e[e.targetFolderMissing=16]="targetFolderMissing",e[e.itemNotFound=17]="itemNotFound",e[e.malwareDetected=18]="malwareDetected",e[e.throttled=19]="throttled",e[e.pathTooLong=20]="pathTooLong",e[e.disconnected=21]="disconnected",e[e.unlockRequired=22]="unlockRequired",e[e.insufficientVaultQuota=23]="insufficientVaultQuota"}(i||(i={}))},2325:function(e,t,n){"use strict";var a=n(109),i=n(327),r=function(){function e(e){this.concurrency=e||1,this._running=0,this._queue=[],this._promiseComplete=this._promiseComplete.bind(this)}return e.prototype.enqueue=function(e){var t;if(this._running<this.concurrency)this._running++,(t=e()).then(this._promiseComplete,this._promiseComplete);else{var n={callback:e,signal:null,canceled:!1,result:null};n.signal=new i.e(function(){n.canceled=!0,a.n.is(n.result)&&n.result.cancel()}),this._queue.push(n),t=n.signal.getPromise()}return a.n.resolve(t)},e.prototype._promiseComplete=function(){var e=this;if(this._running--,this._running<this.concurrency&&this._queue.length){for(var t=this._queue.shift();t&&t.canceled;)t=this._queue.length?this._queue.shift():null;t&&(this._running++,t.result=t.callback(),t.result.then(function(n){t.signal.complete(n),e._promiseComplete()},function(n){t.signal.error(n),e._promiseComplete()}))}},e}();t.e=r},2372:function(e,t,n){"use strict";n.d(t,"e",function(){return a});var a={none:0,overwrite:1,rename:2,replace:3,merge:4};t.t=a},2561:function(e,t,n){"use strict";n.d(t,"e",function(){return r});var a=n(0),i=n(2322),r=function(e){function t(t){var n=e.call(this,Object(a.__assign)(Object(a.__assign)({},t),{isExpected:o(t.errorType)}))||this;return n.message=t.message,n.errorType=t.errorType||i.e.other,n.maxSizeInBytes=t.maxSizeInBytes,n.allowRename=t.allowRename||!1,n.allowMerge=t.allowMerge||!1,n.supportsVersioning=t.supportsVersioning||!1,n.extraData=t.extraData,n.libraryName=t.libraryName,n.isFolder=t.isFolder,n.fixItUrl=t.fixItUrl,n}return Object(a.__extends)(t,e),t}(n(68).e);function o(e){switch(e){case i.e.conflict:case i.e.similarNameExists:case i.e.emptyFileOrFolder:case i.e.emptyFileOrFolderForDocLib:case i.e.fileSize:case i.e.folderUploadNotSupported:case i.e.insufficientVaultQuota:case i.e.invalidName:case i.e.lockMismatch:case i.e.malwareDetected:case i.e.overQuota:case i.e.overQuotaSharedFolder:case i.e.pathTooLong:case i.e.targetFolderMissing:case i.e.throttled:case i.e.unlockRequired:case i.e.versionMismatch:return!0;case i.e.accessDenied:case i.e.itemNotFound:case i.e.disconnected:case i.e.authFailure:case i.e.general:return!1;case i.e.none:case i.e.other:return}}},2857:function(e,t,n){"use strict";n.d(t,"e",function(){return i}),n.d(t,"t",function(){return r});var a=n(2),i=new a.e("entryBatch"),r=new a.e("sourceFile")},2965:function(e,t,n){"use strict";n.d(t,"e",function(){return c});var a=n(218),i=n(327),r=n(109),o=n(2325),s={enqueue:function(e){return e()}},c=function(){function e(e){void 0===e&&(e={}),this.async=new a.e,this.uploaderCount=0,this.throttledSignals=[];var t=e.maxParallelUploads,n=void 0===t?3:t,i=e.maxUploadsPerSecond,r=void 0===i?8:i,c=e.throttleBarrier,d=void 0===c?1e3:c;this.uploadQueue=n===1/0?s:new o.e(n),this.maxUploads=r,this.throttleBarrier=d}return e.prototype.throttle=function(e){var t=this;return this.uploadQueue.enqueue(function(){return!t.isReady&&t.uploaderCount>=t.throttleBarrier&&(t.uploaderCount=0,t.isReady=!0),t.batchStartTime&&t.uploaderCount>=t.maxUploads?t.throttleUploader(e):(t.isReady&&!t.batchStartTime&&(t.batchStartTime=Date.now()),t.startUploader(e))})},e.prototype.addThrottleTimer=function(e){return this.isReady=!0,this.setTimeout(e),this.addUploaderCallback(function(){return r.n.resolve()})},e.prototype.dispose=function(){this.timeout&&(this.async.clearTimeout(this.timeout),this.timeout=void 0),this.async.dispose()},e.prototype.startUploader=function(e){return this.uploaderCount+=1,e()},e.prototype.addUploaderCallback=function(e){var t=this,n=new i.e;return this.throttledSignals.push(n),n.getPromise().then(function(){return t.startUploader(e)})},e.prototype.throttleUploader=function(e){if(this.timeout)return this.addUploaderCallback(e);var t=1e3-(Date.now()-this.batchStartTime);return t>0?(this.setTimeout(t),this.addUploaderCallback(e)):(this.uploaderCount=0,this.batchStartTime=Date.now(),this.startUploader(e))},e.prototype.setTimeout=function(e){var t=this;this.timeout&&(this.async.clearTimeout(this.timeout),this.timeout=void 0),this.timeout=this.async.setTimeout(function(){t.timeout=void 0,t.uploaderCount=0,t.batchStartTime=Date.now();for(var e=0,n=t.throttledSignals;e<n.length;e++)n[e].complete();t.throttledSignals=[]},e)},e}()},2987:function(e,t,n){"use strict";n.d(t,"e",function(){return M});var a,i=n(0),r=n(78),o=n(218),s=n(327),c=n(109),d=n(673),l=n(908),u=n(41),f=n(199),p=n(2322),m=n(68),_=n(2561),h=n(337),b=n(344),g="-2130575257",v="-2130245249",y="-2147023080",S="-2130575245",D="-2147024891",I="UPLOAD_TIMEOUT_ERROR",x="UPLOAD_TOO_SLOW_ERROR";!function(e){e[e.singleChunk=0]="singleChunk",e[e.start=1]="start",e[e.continue=2]="continue",e[e.startFinish=3]="startFinish",e[e.finish=4]="finish",e[e.status=5]="status",e[e.cancel=6]="cancel"}(a||(a={}));var C=function(e){function t(t){var n=e.call(this,Object(i.__assign)(Object(i.__assign)({},t),{extraData:Object(i.__assign)(Object(i.__assign)({},t.extraData||{}),"number"==typeof t.statusCode?{status:t.statusCode}:{})}))||this;n.errorType=t.errorType,n.displayString=t.displayString;try{n.serverError=JSON.stringify(t.serverError)}catch(e){n.serverError=""}return n}return Object(i.__extends)(t,e),t}(m.e);function O(e){return e&&e.code?e.code.split(",")[0]||e.code:e&&e.number?"".concat(e.number):"UNKNOWN_UPLOAD_ERROR"}function w(e,t){return 404===e&&(t===a.start||t===a.startFinish||t===a.singleChunk)}function E(e,t){if(!e)return new C({errorType:p.e.general,code:"Unknown",statusCode:0,message:"Unknown upload error",serverError:e});var n,a,i=!1,r=O(e);if((e instanceof h.e||e instanceof Error&&"GetDataError"===e.name)&&(e=e.errorData),"string"==typeof e)n=e;else{var o=e.message;"string"==typeof o?n=o:o&&o.value&&(n=o.value,i=!0)}return a=r===b.i?p.e.disconnected:r===g?p.e.conflict:r===v?p.e.similarNameExists:r===I?p.e.general:r===D?p.e.accessDenied:"-2147018894"===r?p.e.lockMismatch:r===S?p.e.invalidName:w(e.status,t)?p.e.targetFolderMissing:i?p.e.other:p.e.general,new C({errorType:a,code:r,statusCode:e.status,displayString:i?n:"",message:n||"Unhandled client error",correlationId:e.correlationId,serverError:e})}function A(e){try{return JSON.parse(e).d}catch(e){}}var L=n(2372),k="ServerRelativeUrl,UniqueId,Name,VroomItemID,VroomDriveID,ServerRedirectedUrl",M=function(){function e(e){var t=e.throttler,n=e.dataRequestor,a=e.qosEvent,i=void 0===a?u.e:a,s=e.customerPromise,c=void 0===s?l.e:s,d=e.appName,f=e.webApiUrl,p=e.authToken,m=e.canStream,_=e.fileUpload,h=e.itemExpansion,b=e.destinationUrl,g=e.nameConflictBehavior,v=void 0===g?L.e.none:g,y=e.onStart,S=e.onAbort,D=e.onProgress,I=e.fileHasher,x=e.enableStreamHashing,C=e.testHashingBuffer;this._dataRequestor=n,this._throttler=t,this._qosEvent=i,this._customerPromiseEvent=c,this._chunkNumber=0,this._uploadedBytes=0,this._id=r.e.generate(),this._authToken=p,this._canStream=m,this._webApiUrl=f,this._fileUpload=_,this._async=new o.e(this),this._itemExpansion=h,this._destinationUrl=b,this._nameConflictBehavior=v,this._chunkSize=Math.min(_.size,262144e3),this._trackingHeaders={Application:d,Scenario:"UploadFile",ScenarioType:"AUO"},this._hasher=I,this._enableStreamHashing=x,this._testHashingBuffer=C,this._onStart=y,this._onAbort=S,this._onProgress=D}return e.prototype.upload=function(){var e=this,t=this._throttler.throttle(function(){var t=e._id,n=e._fileUpload.size,a=e._canStream&&n>25165824,i={fileUploadId:t,fileSize:n},r=new e._qosEvent({name:"Upload.h5",extraData:i}),o=a?"SharePointUploader.stream":"SharePointUploader.create",s=new e._qosEvent({name:o,extraData:i}),l=new e._customerPromiseEvent({scenario:"SharePointUpload",extraData:i});return e._fileName=e._fileUpload.name,e._onStart&&e._onStart(),e.start(a).then(function(e){return l.end({resultType:u.t.Success}),s.end({resultType:u.t.Success}),r.end({resultType:u.t.Success}),e},function(t){if(c.n.isCanceled(t))return l.end({resultType:u.t.ExpectedFailure,errorCode:"Aborted"}),s.end({resultType:u.t.ExpectedFailure,resultCode:"Aborted"}),r.end({resultType:u.t.ExpectedFailure,resultCode:"Aborted"}),e._onAbort&&e._onAbort(),c.n.reject(t);var n=function(e){return e instanceof C?e:new C({errorType:p.e.general,code:"Unknown",statusCode:0,innerError:e})}(t),a=function(e){return new _.e({message:e.displayString,errorType:e.errorType,innerError:e,supportsVersioning:!0})}(n),i=function(e){switch(e.errorType){case p.e.disconnected:case p.e.conflict:case p.e.similarNameExists:case p.e.targetFolderMissing:case p.e.lockMismatch:case p.e.invalidName:return!0}switch(e.code){case y:case b.i:case b.a:case b.r:case I:case v:return!0}return!1}(n)?u.t.ExpectedFailure:u.t.Failure,o=Object(d.e)(Object(f.e)(n),{resultType:i,extraData:{uploadedBytes:e._uploadedBytes}}),m=o.extraData,h=o.resultCode;return l.end({resultType:i,extraData:m,errorCode:h}),s.end(o),r.end(Object(d.e)(Object(f.e)(a),{resultType:i,resultCode:p.e[a.errorType]})),c.n.reject(a)})});return this._uploadPromise=t,t},e.prototype.abort=function(){var e=this,t=this._uploadPromise;this._uploadPromise=void 0,this._hasCompleted||t&&(t.cancel(),t.then(function(){},function(){}).done(function(){return e.cleanStream()}))},e.prototype.restart=function(e){var t=e.nameConflictBehavior,n=void 0===t?this._nameConflictBehavior:t;this._nameConflictBehavior=n;var a=this._uploadPromise;return this._uploadPromise=void 0,a&&a.cancel(),this.upload()},e.prototype.dispose=function(){this._async.dispose()},e.prototype.start=function(e){var t=this;this._uploadedBytes=0;var n=this._fileUpload.size;return(e?this.streamFile():this.uploadFile()).then(function(e){return t.updateProgress(n,!0),e})},e.prototype.updateProgress=function(e,t){e<this._uploadedBytes&&!t||this._uploadedBytes!==e&&(this._uploadedBytes=e,this._onProgress&&this._onProgress(e))},e.prototype.getUploadUrl=function(e){var t=this._webApiUrl;t=(t=t.methodWithAliases("GetFolderByServerRelativePath",{DecodedUrl:this._destinationUrl})).segment("Files");var n={};return n.DecodedUrl=this._fileName,this._nameConflictBehavior===L.e.overwrite||this._nameConflictBehavior===L.e.replace?n.overwrite=!0:this._nameConflictBehavior===L.e.rename&&(n.EnsureUniqueFileName=!0),n.AutoCheckoutOnInvalidData=!0,e&&(n.XorHash=e),t=t.methodWithAliases("AddUsingPath",n).oDataParameter("$Select",k),this._itemExpansion&&(t=t.oDataParameter("$Expand",this._itemExpansion)),t.toString()},e.prototype.uploadFile=function(e){var t=this;void 0===e&&(e=3);var n=this._fileUpload.slice(0,this._fileUpload.size);return(this._hasher&&!this._hasher.hasFullHash(this._id)?this._hasher.computeHashPromise(n,0,n.size,this._id,{testBuffer:this._testHashingBuffer,newSPChunk:!0}):c.n.resolve()).then(function(){var i=t._hasher&&!t._hasher.getError(t._id)?t._hasher.getFullHash(n.size,t._id):void 0;return t.uploadChunk({trackSpeed:!1,url:t.getUploadUrl(i),qosName:"SharePointUploader.UploadFile",data:n,offset:0,length:n.size,checksum:i}).catch(function(n){if(c.n.isCanceled(n))return c.n.wrapError(n);if(n&&n.retryAfter&&e>0){var i=1e3*n.retryAfter;return t._throttler.addThrottleTimer(i).then(function(){return t._uploadedBytes=0,t.uploadFile(e-1)})}return c.n.wrapError(E(n,a.singleChunk))})})},e.prototype.getUploadStage=function(e){var t,n=this._fileUpload.size,i="SharePointUploader.",r=Math.min(this._chunkSize+e,n);return 0===this._chunkNumber?n<=r?(i+="StartFinish",t=a.startFinish):(r=0,i+="Start",t=a.start):n<=r?(i+="Finish",t=a.finish):(i+="Continue",t=a.continue),{endByte:r,qosName:i,uploadStage:t}},e.prototype.getStreamingUrl=function(e,t,n){var i,r=this._webApiUrl,o=this._fileName,s={uploadId:{guid:this._requestId}};return i=t===a.start?"StartUploadFile":t===a.startFinish?"Upload":t===a.continue?"ContinueUpload":n?"FinishUploadWithChecksum":"FinishUpload",t!==a.start&&t!==a.startFinish||(r=(r=r.methodWithAliases("GetFolderByServerRelativePath",{DecodedUrl:this._destinationUrl})).segment("Files"),r=this._nameConflictBehavior===L.e.overwrite||this._nameConflictBehavior===L.e.replace?r.methodWithAliases("GetByPathOrAddStub",{DecodedUrl:o}):this._nameConflictBehavior===L.e.rename?r.methodWithAliases("AddStubUsingPath",{DecodedUrl:o,EnsureUniqueFileName:!0}):r.methodWithAliases("AddStubUsingPath",{DecodedUrl:o})),t!==a.continue&&t!==a.finish||(r=r.methodWithAliases("GetFileByServerRelativePath",{DecodedUrl:"".concat(this._destinationUrl,"/").concat(o)}),s.fileOffset=e,n&&t===a.finish&&(s.checksum=n)),r=r.methodWithAliases(i,s),t!==a.finish&&t!==a.startFinish||(r=r.oDataParameter("$Select",k),this._itemExpansion&&(r=r.oDataParameter("$Expand",this._itemExpansion))),r.toString()},e.prototype.streamFile=function(e,t){var n=this;void 0===e&&(e=0),void 0===t&&(t=3),this._requestId||(this._requestId=r.e.generate());var i=this.getUploadStage(e),o=i.endByte,d=i.qosName,l=i.uploadStage,u=this._fileUpload.slice(e,o),f=this._fileUpload.size,p=l===a.finish,m=this._enableStreamHashing&&this._hasher&&l!==a.start&&!this._hasher.hasFullHash(this._id)&&!this._hasher.getError(this._id)&&this._hasher?this._hasher.computeHashPromise(u,e,o,this._id,{newSPChunk:!0,testBuffer:this._testHashingBuffer}):c.n.resolve();return(p?m:c.n.resolve()).then(function(){var i=void 0;return n._enableStreamHashing&&n._hasher&&!n._hasher.getError(n._id)&&p&&(i=n._hasher.getFullHash(f,n._id)),n.uploadChunk({trackSpeed:!0,url:n.getStreamingUrl(e,l,i),qosName:d,data:u,offset:e,length:u.size,checksum:i}).then(function(e){return n.updateProgress(o,!0),l===a.start&&n._nameConflictBehavior==L.e.rename&&e.Name&&(n._fileName=e.Name),o<f?(n._chunkNumber++,m.then(function(){return n.streamFile(o,t)})):e},function(a){if(c.n.isCanceled(a))return n.cleanStream({stage:l}),c.n.reject(a);if(a&&a.retryAfter&&t>0){var i=1e3*a.retryAfter;return n._throttler.addThrottleTimer(i).then(function(){return n.streamFile(e,t-1)})}if((o=O(r=a))===x||o===I||r&&0===r.status)return n._chunkSize<=1048576?(n.cleanStream(),c.n.reject(E(a,l))):(n._chunkSize=Math.floor(n._chunkSize/2),n.streamFile(e,t));var r,o;if(t>0&&function(e,t){if(429===e.status)return!1;if(w(e.status,t))return!1;switch(O(e)){case b.r:case"-1":case g:case v:case"-2130575142":case"-2130209002":case"-2130209003":case y:case S:case D:return!1;default:return!0}}(a,l)){var d,u=new s.e(function(){d&&n._async.clearTimeout(d)});return d=n._async.setTimeout(function(){return u.complete()},1e3),u.getPromise().then(function(){return n.getUploadStatus().then(function(e){return e>0&&!n._chunkNumber&&(n._chunkNumber=1),n.streamFile(e,t-1)},function(){return n.streamFile(e,t-1)})})}return n.cleanStream({stage:l,error:a}),c.n.reject(E(a,l))})},function(e){return n.cleanStream({stage:l}),c.n.reject(e)})},e.prototype.getUploadStatus=function(){var e=this._webApiUrl.methodWithAliases("GetFileByServerRelativePath",{DecodedUrl:"".concat(this._destinationUrl,"/").concat(this._fileName)}).methodWithAliases("GetUploadStatus",{uploadId:{guid:this._requestId}}).toString();return this._dataRequestor.getData({url:e,method:"GET",noRedirect:!0,authToken:this._authToken,qosName:"SharePointUploader.GetUploadStatus",additionalHeaders:this._trackingHeaders,qosExtraData:{fileUploadId:this._id},telemetryHandler:function(e){var t=e.eventData,n=e.response;if(t.resultType===u.t.Success){if(!n||!n.d||!n.d.ExpectedContentRange)return{eventData:Object(i.__assign)(Object(i.__assign)({},t),{resultCode:"NoContentRange",resultType:u.t.Failure})};var a=parseInt(n.d.ExpectedContentRange.split("-")[0],10);if(isNaN(a))return{eventData:Object(i.__assign)(Object(i.__assign)({},t),{resultCode:"NaNContentRange",resultType:u.t.Failure,error:n.d.ExpectedContentRange})}}return{eventData:t}}}).then(function(e){if(e.d&&e.d.ExpectedContentRange){var t=parseInt(e.d.ExpectedContentRange.split("-")[0],10);return isNaN(t)?c.n.reject(""):t}return c.n.reject("")})},e.prototype.cleanStream=function(e){var t=!!this._requestId&&(!e||function(e){var t=e.stage,n=e.error;if(t===a.startFinish)switch(O(n)){case g:case v:case D:case S:return!1;default:return!0}return t!==a.start}(e)),n=t?this.cancelUpload():c.n.resolve();return this._requestId="",this._chunkNumber=0,n},e.prototype.cancelUpload=function(){var e=this._webApiUrl.methodWithAliases("GetFileByServerRelativePath",{DecodedUrl:"".concat(this._destinationUrl,"/").concat(this._fileName)}).methodWithAliases("CancelUpload",{uploadId:{guid:this._requestId}}).toString();return this._dataRequestor.getData({url:e,noRedirect:!0,authToken:this._authToken,qosName:"SharePointUploader.CancelUploadSession",additionalHeaders:this._trackingHeaders,qosExtraData:{fileUploadId:this._id}}).then(function(){})},e.prototype.uploadChunk=function(e){var t,n,a,i,r,o=e.url,c=e.qosName,l=e.data,u=e.offset,f=e.length,p=e.checksum,m=this._chunkNumber>0&&u+f>=this._fileUpload.size;return function(e){var t,n=e.async,a=e.url,i=e.qosName,r=e.data,o=e.offset,c=e.length,l=!1,u=new s.e(function(){l=!0,t.cancel()}),f={},p=function(e,t){f.resultCode=e,f.extraData=t,u.error({code:e,message:""})},m=function(e){var t,n=e.async;return{refresh:function(a){var i=e.isFinalStreamingChunk?3e5:1e4,r=Math.min(Math.max(.08*a,i),2147483647);return t&&n.clearTimeout(t),a&&(t=n.setTimeout(function(){e.onFailure(I,{totaltBytesRemaining:a,inactivityTime:r})},r)),t},dispose:function(){t&&n.clearTimeout(t)}}}({async:n,onFailure:p,isFinalStreamingChunk:e.isFinalStreamingChunk}),_=e.trackSpeed?function(e){var t,n=e.async,a=e.length,i=Date.now(),r=Date.now(),o=0,s=0,c=0,d=0,l=n.setInterval(function(){c&&Date.now()-i+(a-o)/((s+t)/(c+1))>15e4&&o<a&&d++>=3&&e.onFailure(x,{averageBandwidth:t,bandwidthCumulative:s,bandwidthCount:c})},1e4);return{update:function(e){var n=Date.now();s+=(e-o)/(n-r),c++,t=e/(n-i),r=n,o=e},dispose:function(){l&&n.clearInterval(l)}}}({async:n,length:c,onFailure:p}):void 0,h=n.debounce(function(t){e.updateProgress(t)},100,{leading:!1}),b=0;t=e.dataRequestor.getData({url:a,qosName:i,noRedirect:!0,telemetryHandler:function(t){var n=t.eventData,a=t.errorData,i=t.serverData,r=n.resultCode;if(!f.resultCode&&i&&a){var o=i.getResponseHeader("X-SubStatusCode");if(o){var s=i.getStatus();r="[".concat(s.toString(),"][").concat(o,"] ").concat(a.code)}}var l={bytesUploaded:b,chunkSize:c};return{eventData:Object(d.e)(t.eventData,{resultCode:r},f,{extraData:l},{extraData:e.qosExtraData})}},authToken:e.authToken,additionalHeaders:e.additionalHeaders,parseResponse:A,contentType:"application/octet-stream",additionalPostData:r,onUploadProgress:function(e){e.lengthComputable&&(b=e.loaded,_&&_.update(e.loaded),h(o+e.loaded),m.refresh(c-e.loaded))}}),m.refresh(c);var g=function(){m.dispose(),_&&_.dispose()},v=u.getPromise();return t.done(function(e){u.complete(e)},function(e){l||u.error(e)}),v.then(function(){return g()},function(){l||t.cancel(),g()}),v}({async:this._async,dataRequestor:this._dataRequestor,data:l,url:o,qosName:c,authToken:this._authToken,qosExtraData:{fileUploadId:this._id,wasHashed:!!this._hasher,calculatedHash:p,hashThread:null===(t=this._hasher)||void 0===t?void 0:t.getHashThread(this._id),timeSpentHashing:null===(n=this._hasher)||void 0===n?void 0:n.getTimeHashing(this._id),timeComputing:null===(a=this._hasher)||void 0===a?void 0:a.getTimeComputing(this._id),timeDelayBeforeHashing:null===(i=this._hasher)||void 0===i?void 0:i.getDelayTimeBeforeHash(this._id),hashError:null===(r=this._hasher)||void 0===r?void 0:r.getError(this._id)},additionalHeaders:this._trackingHeaders,offset:u,length:f,trackSpeed:e.trackSpeed,isFinalStreamingChunk:m,updateProgress:this.updateProgress.bind(this)})},e}()},3862:function(e,t,n){"use strict";n.d(t,"t",function(){return Y}),n.d(t,"e",function(){return J});var a=n(0),i=n(78),r=n(40),o=n(164),s=n(37),c=n(2987),d=n(2965),l=n(95),u=n(1),f=n(745),p=n(58),m=n(144),_=n(2857),h=n(225),b=n(2),g=n(48),v=n(468),y=n(150),S=n(2372),D=n(303),I=n(4),x=n(14),C=n(167),O=n(109),w=n(169),E=n(2322),A=n(188),L=n(2561),k=n(1298),M=n(54),P=n(218),T=n(327),U=n(1481),F=n(577),H=Math.floor(5.96875);function R(e,t,n,a){return((e||0)^(a&4294967295>>32-n)<<t>>>0)>>>0}function N(e){return new Uint8Array([255&e,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24])}function B(e,t,n,a,i){for(var r=0;r<i;r++)n[a+r]=e[t+r]}var j=8388608,V=function(){function e(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this._async=new P.e,this._fileArray=[],this._isTest=e,this._isTest?this._ignoreHash=t:this._spWebWorkerProxy=U.e.instance}return e.prototype.computeHashPromise=function(e,t,n,i,r){var o;return Object(a.__awaiter)(this,void 0,O.n,function(){var s,c,d,l,u,f,p,m=this;return Object(a.__generator)(this,function(a){switch(a.label){case 0:if(this.getError(i))return[2];if(this.hasFullHash(i))return[2,Promise.reject(new Error("Cannot compute hash because we already computed final hash"))];if(s=t+j>=n?n:t+j,c=this._getCurrentFile(i)){if(r&&r.newSPChunk){if(t>c.currentEndByte+j&&this.completeJob(i,"SP stream chunk was skipped"),t<c.currentEndByte)return this._async.clearTimeout(c.currentJob.timeout),[2,Promise.resolve()];c.currentEndByte=n,c.currentTimeSpentHashing=0,c.timeComputing=0,c.timeDelayBeforeHash=0}c.currentStartByte=t,c.currentSmallChunkEndByte=s}else d={data:Array.apply(null,Array(H)).map(Number.prototype.valueOf,0),shiftSoFar:0,endByteHashed:0},c={fileId:i,currentStartByte:t,currentSmallChunkEndByte:s,currentEndByte:n,finalHash:"",hashInfo:d,thread:!this._isTest&&this._spWebWorkerProxy.isRunning?"webworker":"main",currentTimeSpentHashing:0,timeComputing:0,timeDelayBeforeHash:0},this._fileArray.push(c);return l=(null===(o=c.currentJob)||void 0===o?void 0:o.signal)&&!(null==r?void 0:r.newSPChunk)?c.currentJob.signal:new T.e,c.currentJob={data:e,signal:l,endByte:n,nextStartByte:s,timeout:this._async.setTimeout(function(){m.completeJob(i,"Thread did not respond")},3e4)},this._isTest&&(null==r?void 0:r.testBuffer)?(this._syncHash(c,null==r?void 0:r.testBuffer,t,s,i),[3,4]):[3,1];case 1:return a.trys.push([1,3,,4]),[4,z(e)];case 2:return(u=a.sent()).byteLength>0?(f={buffer:u,startByte:t,endByte:s},c.lastHashInput=f,this._spWebWorkerProxy.isRunning&&!this._handlerLoadError?(c.startTimeHashing=Date.now(),this._spWebWorkerProxy.postMessage({requestId:i+t.toString(),target:F.e.Upload.HandlerId,operation:F.e.Upload.Operation.Hash,payload:{info:c.hashInfo,input:f,fileId:i,startDelayTime:Date.now()}},this.handleWorkerMessage.bind(this))):this._syncHash(c,u,t,s,i)):this.completeJob(i),[3,4];case 3:return p=a.sent(),this.completeJob(i,p.message),[3,4];case 4:return[2,l.getPromise()]}})})},e.prototype.hasFullHash=function(e){var t=this._getCurrentFile(e);return!!(null==t?void 0:t.finalHash)},e.prototype.getFullHash=function(e,t){var n=this._getCurrentFile(t);return n.finalHash||(n.finalHash=function(e,t){for(var n=Math.floor(20.875),a=new Array(n),i=0;i<H-1;i++)B(N(e.data[i]),0,a,4*i,4);B(N(e.data[H-1]),0,a,4*(H-1),a.length-4*(H-1));var r=function(e){var t=new ArrayBuffer(8);return new DataView(t).setBigUint64(0,BigInt(e),!0),new Uint8Array(t)}(t);for(i=0;i<r.length;i++)a[n-r.length+i]^=r[i];return btoa(String.fromCharCode.apply(null,a))}(n.hashInfo,e)),n.finalHash},e.prototype.getHashThread=function(e){var t=this._getCurrentFile(e);return(null==t?void 0:t.thread)||void 0},e.prototype.getTimeHashing=function(e){var t=this._getCurrentFile(e);return(null==t?void 0:t.currentTimeSpentHashing)||0},e.prototype.getTimeComputing=function(e){var t=this._getCurrentFile(e);return(null==t?void 0:t.timeComputing)||0},e.prototype.getDelayTimeBeforeHash=function(e){var t=this._getCurrentFile(e);return null==t?void 0:t.timeDelayBeforeHash},e.prototype.getError=function(e){var t=this._getCurrentFile(e);return(null==t?void 0:t.error)||void 0},e.prototype.handleWorkerMessage=function(e){var t,n,a,i,r=this,o=Date.now();if(!e)return this.completeJob("","Invalid response from web worker");if(e.errorMessage)this._handlerLoadError||(this._handlerLoadError=!0,this._fileArray.forEach(function(e){if(e.lastHashInput){var t=e.lastHashInput,n=t.buffer,a=t.startByte,i=t.endByte;r._syncHash(e,n,a,i,e.fileId)}}));else{if(!(e.payload&&(null===(t=e.payload)||void 0===t?void 0:t.info)&&(null===(n=e.payload)||void 0===n?void 0:n.fileId)))return this.completeJob((null===(a=e.payload)||void 0===a?void 0:a.fileId)||"","Invalid response from web worker");if(null===(i=e.payload)||void 0===i?void 0:i.error)return this.completeJob(e.payload.fileId,e.payload.error);var s=this._getCurrentFile(e.payload.fileId);if(null==s?void 0:s.currentJob){s.timeDelayBeforeHash+=e.payload.timeDelayUntilHashing,s.timeComputing+=e.payload.timeComputing,s.currentTimeSpentHashing+=o-s.startTimeHashing,this._async.clearTimeout(s.currentJob.timeout),s.hashInfo=e.payload.info;var c=s.currentJob,d=c.nextStartByte,l=c.endByte;d>=l?this.completeJob(s.fileId):this.computeHashPromise(s.currentJob.data.slice(j),d,l,s.fileId)}}},e.prototype.completeJob=function(e,t){var n=this._getCurrentFile(e);n&&(t&&(n.error=t),n.currentJob&&(this._async.clearTimeout(n.currentJob.timeout),n.currentJob.signal.complete()))},e.prototype._getCurrentFile=function(e){return this._fileArray.find(function(t){return t.fileId===e})},e.prototype._syncHash=function(e,t,n,a,i){var r=e.hashInfo,o={buffer:t,startByte:n,endByte:a};if(e.startTimeHashing=Date.now(),!this._isTest||!this._ignoreHash){var s=Date.now(),c=function(e,t){if(t.buffer.byteLength>0){var n=new Uint8Array(t.buffer),a=0;e.endByteHashed>0&&e.endByteHashed>=t.startByte&&(a=e.endByteHashed-t.startByte+1),function(e,t,n){for(var a=n;a<t.length;a++){var i=e.shiftSoFar,r=Math.floor(e.shiftSoFar/32),o=e.shiftSoFar%32,s=r<e.data.length-1,c=t[a];if(o<=24)e.data[r]=R(e.data[r],o,8,c);else{var d=r,l=s?r+1:0,u=s?32-o:160-i,f=8-u;e.data[d]=R(e.data[d],o,u,c),e.data[l]=R(e.data[l],0,f,c>>u)}e.shiftSoFar=(e.shiftSoFar+11)%160}}(e,n,a),e.endByteHashed=t.endByte-1}return e}(r,o),d=Date.now();e.currentTimeSpentHashing+=d-e.startTimeHashing,e.timeComputing+=d-s,e.hashInfo=c}var l=e.currentJob,u=l.nextStartByte,f=l.endByte;if(!(u>=f))return this._isTest&&(this._async.clearTimeout(e.currentJob.timeout),e.currentJob.signal.complete()),this.computeHashPromise(this._isTest?e.currentJob.data:e.currentJob.data.slice(j),u,f,e.fileId,this._isTest&&{testBuffer:t.slice(j)});this.completeJob(i)},e}();function z(e){return Object(a.__awaiter)(this,void 0,void 0,function(){var t,n;return Object(a.__generator)(this,function(a){return t=new T.e,(n=new FileReader).onload=function(){t.complete(n.result)},n.onerror=function(){n.abort(),t.error(new Error("Unable to read data Blob as ArrayBuffer using FileReader"))},n.readAsArrayBuffer(e.slice(0,Math.min(j,e.size))),[2,t.getPromise()]})})}var G=n(1896),K=n(68),W=n(179),q=Object(D.e)(function(){return new d.e({maxParallelUploads:1/0})}),Q=function(e){return function(t){var n=t.demandItemFacet(u.St,e);return!(n&&!s.t.hasItemPermission({permissions:n},s.t.editListItems))}};function Y(e){var t=this,n=e.itemKey,d=e.options.sourceEntries,S=r.e.deserialize(n),D=S.webAbsoluteUrl,P=S.listFullUrl,T=Object.keys(d)[0],U=d[T],F=U.progressItemKey,H=U.conflictResolution;return function(e){return Object(a.__awaiter)(t,void 0,void 0,function(){var t,d,U,R,N,B,j,z,Y,X,Z,$,ee,te,ne,ae,ie,re,oe,se,ce,de,le,ue,fe,pe,me,_e,he,be,ge,ve,ye,Se,De,Ie,xe,Ce,Oe;return Object(a.__generator)(this,function(we){switch(we.label){case 0:return t=e(Object(l.n)({webAbsoluteUrl:D,listFullUrl:P})),d=t.dataRequestor,U=t.hasDigest,t.hasTokenProvider?(N=void 0,[3,3]):[3,1];case 1:return[4,e(Object(l.e)({url:D||P,disallowCookies:!U}))];case 2:N=we.sent(),we.label=3;case 3:if(R=N,!(B=e(Object(m.e)({sourceFile:_.t},T)).sourceFile))throw new K.e({code:"MissingSourceFileForUpload",message:"No source file for upload."});if(j=e(Object(m.e)({folderPath:u.he},n)).folderPath,!(z=void 0===j?S.rootFolder:j))throw new K.e({code:"MissingTargetFolderPathForUpload",message:"No path information for target folder."});Y=e(Object(y.e)(function(e,t){return function(t){var n=Object(M.e)(t,e);return 1024*(n&&n.maximumFileSize||Number.POSITIVE_INFINITY)*1024}}(n))),B.size>Y&&function(e){throw new k.e({facets:Object(a.__assign)({},w.d.pack({maxFileSize:e}))})}(Y),X=Object(v.a)({webAbsoluteUrl:D,listOrItemFullUrl:P}),Z=new f.e(void 0),$=Z.debounce(function(t){var n;F&&e(Object(h.e)({items:(n={},n[F]=Object(b.t)({progressSize:g.g},{progressSize:{current:t}}),n)}))},300,{leading:!1}),ee=o.e.serialize({webAbsoluteUrl:D,listFullUrl:P}),te=e(Object(y.e)(function(e){return e.demandItemFacet(u.We,ee)})),ne=!(!te||!te.contentTypesEnabled||te.templateType===x.t.mySiteDocumentLibrary),ae=J(H),ie=e(Object(C.e)({clientName:p.t,enableUploadHashingConfiguration:u.se,enableStreamUploadHashingConfiguration:u.re})),re=ie.clientName,oe=ie.enableUploadHashingConfiguration,se=ie.enableStreamUploadHashingConfiguration,ce=new c.e({authToken:R,onProgress:$,dataRequestor:d,nameConflictBehavior:ae,webApiUrl:X,fileUpload:B,destinationUrl:z,appName:re||"Unknown",throttler:e(q),canStream:e(Object(y.e)(Q(n))),itemExpansion:ne?"ListItemAllFields/ContentType/Fields":"ListItemAllFields",fileHasher:oe?new V:void 0,enableStreamHashing:se}),F&&e(Object(h.e)({items:(De={},De[F]=Object(a.__assign)({},g.g.pack({total:B.size,current:0})),De)})),de=ce.upload(),le=e(Object(y.e)(function(e){return e.demandItemFacet(g.i,F)})),ue=le?le.token.subscribe(function(){ce.abort()}):void 0,we.label=4;case 4:return we.trys.push([4,6,7,8]),[4,de];case 5:return fe=we.sent(),[3,8];case 6:throw pe=we.sent(),ce.abort(),F&&e(Object(h.e)({items:(Ie={},Ie[F]=Object(a.__assign)({},g.g.pack({total:B.size,current:0})),Ie)})),e((Ee=pe,function(e){if(O.n.isCanceled(Ee))return new A.e;if(Ee instanceof L.e)return new k.e({facets:e((i=Ee,function(e){if(i.errorType===E.e.conflict||i.errorType===E.e.similarNameExists){var t=e(Object(C.e)({enableRenameOnUploadConflict:u.Z})).enableRenameOnUploadConflict;switch(i.errorType){case E.e.conflict:return Object(a.__assign)(Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({},w.b.pack({})),w.t.pack(!!t)),w.n.pack(!0)),w.r.pack({supportsRename:!!t}));case E.e.similarNameExists:return Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({},w.x.pack({})),w.t.pack(!0)),w.n.pack(!1))}}switch(i.errorType){case E.e.accessDenied:return Object(a.__assign)({},w.e.pack({}));case E.e.disconnected:return Object(a.__assign)({},w.v.pack({}));case E.e.emptyFileOrFolder:case E.e.emptyFileOrFolderForDocLib:return Object(a.__assign)({},w.o.pack({}));case E.e.folderUploadNotSupported:return Object(a.__assign)({},w.l.pack({}));case E.e.invalidName:return Object(a.__assign)({},w.f.pack({}));case E.e.malwareDetected:return Object(a.__assign)({},w.h.pack({}));case E.e.overQuota:return Object(a.__assign)({},w.S.pack({}));case E.e.targetFolderMissing:return Object(a.__assign)({},w.C.pack({}));case E.e.throttled:return Object(a.__assign)({},w.O.pack({}));case E.e.versionMismatch:return Object(a.__assign)({},w.w.pack({}))}return Object(a.__assign)({},w.I.pack({}))})),innerError:Ee});if(function(e){return!!e&&("status"in e||!(!e.message||"object"!=typeof e.message))}(Ee)){var t=e(Object(C.e)({enableRenameOnUploadConflict:u.Z})).enableRenameOnUploadConflict;return new k.e({facets:Object(a.__assign)(Object(a.__assign)({},"-2130575257"===Ee.code?Object(a.__assign)({},w.r.pack({supportsRename:!!t})):Object(a.__assign)({},w.I.pack({}))),u.tn.pack(Ee)),message:(n=Ee,n&&n.message&&("object"==typeof n.message?n.message.value:n.message.toString())||"")})}var n,i;return Ee}));case 7:return ue&&ue(),Z.dispose(),ce.dispose(),[7];case 8:return me=fe.ServerRelativeUrl,_e=fe.ServerRedirectedUrl,he=fe.ListItemAllFields&&fe.ListItemAllFields.Id?String(fe.ListItemAllFields.Id):fe.ServerRelativeUrl,be=r.e.serialize({webAbsoluteUrl:D,listFullUrl:P,itemId:he}),ge=fe.UniqueId?i.e.normalizeLower(fe.UniqueId):"",ve=fe.Name,ye=new W.e(D).authority,Se=ye&&me?"".concat(ye).concat(me):"",F&&e(Object(h.e)({items:(xe={},xe[F]=Object(a.__assign)({},I.u.pack(ve)),xe)})),e(Object(G.e)({items:(Ce={},Ce[be]=Object(a.__assign)({},u.St.pack(s.t.openItems)),Ce)})),e(Object(h.e)({items:(Oe={},Oe[be]=Object(a.__assign)(Object(a.__assign)(Object(a.__assign)(Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({},I.u.pack(ve)),ge?u.Tn.pack(ge):{}),me?u.he.pack(me):{}),_e?I.A.pack(_e):{}),I.k.pack({itemKey:n})),Se?I.i.pack(Se):{}),Oe)})),[2,{itemKey:be}]}var Ee})})}}function J(e){switch(e){case"replace":return S.e.overwrite;case"rename":return S.e.rename;default:return S.e.none}}}}]);